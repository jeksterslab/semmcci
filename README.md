semmcci
================
Ivan Jacob Agaloos Pesigan
2022-09-13

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- badges: start -->

[![R-CMD-check](https://github.com/jeksterslab/semmcci/workflows/R-CMD-check/badge.svg)](https://github.com/jeksterslab/semmcci/actions)
[![test-coverage](https://github.com/jeksterslab/semmcci/actions/workflows/test-coverage.yaml/badge.svg)](https://github.com/jeksterslab/semmcci/actions/workflows/test-coverage.yaml)
[![codecov](https://codecov.io/gh/jeksterslab/semmcci/branch/main/graph/badge.svg?token=KVLUET3DJ6)](https://codecov.io/gh/jeksterslab/semmcci)
<!-- badges: end -->

## Description

Monte Carlo confidence intervals for free and defined parameters in
models fitted in the structural equation modeling package `lavaan` can
be generated using the `semmcci` package. The package has two main
functions, namely, `MC()` and `MCStd()`. The output of `lavaan` is
passed as the first argument to the `MC()` function to generate Monte
Carlo confidence intervals. Monte Carlo confidence intervals for the
standardized estimates can also be generated by passing the output of
the `MC()` function to the `MCStd()` function.

## Installation

You can install the released version of `semmcci` from
[GitHub](https://github.com/jeksterslab/semmcci) with:

``` r
install.packages("remotes")
remotes::install_github("jeksterslab/semmcci")
```

## More Information

See [GitHub Pages](https://jeksterslab.github.io/semmcci/index.html) for
package documentation.

## The Monte Carlo Method

In the Monte Carlo method, a sampling distribution of parameter
estimates is generated from the multivariate normal distribution using
the parameter estimates and the sampling variance-covariance matrix.
Confidence intervals for defined parameters are generated by obtaining
percentiles corresponding to 100(1 - α)% from the generated sampling
distribution, where α is the significance level.

## Example

A common application of the Monte Carlo method is to generate confidence
intervals for the indirect effect. In the simple mediation model,
variable `X` has an effect on variable `Y`, through a mediating variable
`M`. This mediating or indirect effect is a product of path coefficients
from the fitted model.

``` r
library(semmcci)
library(lavaan)
```

### Data

``` r
n <- 1000
X <- rnorm(n = n)
M <- 0.50 * X + rnorm(n = n)
Y <- 0.25 * X + 0.50 * M + rnorm(n = n)
data <- data.frame(X, M, Y)
```

### Model Specification

The indirect effect is defined by the product of the slopes of paths `X`
to `M` labeled as `a` and `M` to `Y` labeled as `b`. In this example, we
are interested in the confidence intervals of `indirect` defined as the
product of `a` and `b` using the `:=` operator in the `lavaan` model
syntax.

``` r
model <- "
  Y ~ cp * X + b * M
  M ~ a * X
  indirect := a * b
  direct := cp
  total := cp + (a * b)
"
```

### Model Fitting

We can now fit the model using the `sem()` function from `lavaan`.

``` r
fit <- sem(data = data, model = model)
```

### Monte Carlo Confidence Intervals

The `fit` `lavaan` object can then be passed to the `MC()` function to
generate Monte Carlo confidence intervals.

``` r
MC(fit, R = 20000L, alpha = c(0.001, 0.01, 0.05))
#> Monte Carlo Confidence Intervals
#>             est     se     R  0.05%   0.5%   2.5%  97.5%  99.5% 99.95%
#> cp       0.2373 0.0365 20000 0.1212 0.1436 0.1663 0.3089 0.3300 0.3515
#> b        0.4817 0.0328 20000 0.3746 0.3977 0.4181 0.5470 0.5668 0.5836
#> a        0.5098 0.0311 20000 0.4078 0.4296 0.4484 0.5713 0.5905 0.6119
#> Y~~Y     1.0581 0.0476 20000 0.9044 0.9372 0.9653 1.1522 1.1808 1.2107
#> M~~M     0.9712 0.0438 20000 0.8218 0.8576 0.8859 1.0572 1.0858 1.1174
#> indirect 0.2456 0.0226 20000 0.1728 0.1915 0.2030 0.2914 0.3073 0.3242
#> direct   0.2373 0.0365 20000 0.1212 0.1436 0.1663 0.3089 0.3300 0.3515
#> total    0.4829 0.0359 20000 0.3633 0.3899 0.4137 0.5539 0.5738 0.5997
```

### Standardized Monte Carlo Confidence Intervals

Standardized Monte Carlo Confidence intervals can be generated by
passing the result of the `MC()` function to `MCStd()`.

> **Note:** We recommend setting `fixed.x = FALSE` when generating
> standardized estimates and confidence intervals to model the variances
> and covariances of the predictors if they are assumed to be random.

> **Note:** We recommend setting `par = TRUE` and `ncores` to the number
> of cores to use when generating standardized estimates and confidence
> intervals in order to speed up the process.

``` r
fit <- sem(data = data, model = model, fixed.x = FALSE)
unstd <- MC(fit, R = 20000L, alpha = c(0.001, 0.01, 0.05))
```

``` r
MCStd(unstd, par = TRUE, ncores = parallel::detectCores())
```

    #> Standardized Monte Carlo Confidence Intervals
    #>             est     se     R  0.05%   0.5%   2.5%  97.5%  99.5% 99.95%
    #> cp       0.1930 0.0296 20000 0.0896 0.1147 0.1339 0.2501 0.2682 0.2890
    #> b        0.4340 0.0276 20000 0.3419 0.3626 0.3794 0.4875 0.5049 0.5235
    #> a        0.4602 0.0251 20000 0.3750 0.3945 0.4102 0.5091 0.5233 0.5392
    #> Y~~Y     0.6972 0.0242 20000 0.6131 0.6322 0.6481 0.7431 0.7573 0.7768
    #> M~~M     0.7882 0.0231 20000 0.7093 0.7262 0.7408 0.8317 0.8444 0.8594
    #> X~~X     1.0000 0.0000 20000 1.0000 1.0000 1.0000 1.0000 1.0000 1.0000
    #> indirect 0.1998 0.0170 20000 0.1453 0.1576 0.1671 0.2340 0.2450 0.2573
    #> direct   0.1930 0.0296 20000 0.0896 0.1147 0.1339 0.2501 0.2682 0.2890
    #> total    0.3928 0.0271 20000 0.3038 0.3214 0.3383 0.4444 0.4604 0.4809
