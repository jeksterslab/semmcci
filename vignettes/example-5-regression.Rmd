---
title: "Example 5: Standardized Regression Coefficients"
author: "Ivan Jacob Agaloos Pesigan"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Example 5: Standardized Regression Coefficients}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| include = FALSE
set.seed(42)
```

```{r}
#| include = FALSE
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The multiple regression model is given by

\begin{equation}
    Y = \beta_{0} + \beta_{1} X_{1} + \cdots + \beta_{j} X_{j} + \cdots + \beta_{p} X_{p} + \varepsilon, \quad j = \left\{ 1, 2, \cdots p \right\}
\end{equation}

where $Y$ is the regressand variable, $X_{1} \cdots X_{j} \cdots X_{p}$ are the $p$ regressors, and $\varepsilon$ is the stochastic error term with expected value of zero and variance $\sigma^{2}$.

```{tikz}
#| echo = FALSE, 
#| fig.cap = "The Multiple Regression Model", 
#| fig.ext = 'png', 
#| cache = FALSE
\usetikzlibrary{
	er,
	arrows,
	positioning
}

\begin{tikzpicture}[
		auto,
		node distance = 15mm and 50mm,
		manifest/.style = {
			rectangle,
			draw,
			thick,
			inner sep = 0pt,
			minimum width = 15mm,
			minimum height = 10mm
		},
		inv/.style = {
			rectangle,
			draw=none,
			fill=none,
			inner sep = 0pt,
			minimum width = 15mm,
			minimum height = 10mm
		},
		error/.style = {
			ellipse,
			draw,
			thick,
			inner sep = 0pt,
			minimum size = 7mm,
			align = center
		},
		mean/.style={
			regular polygon,
			regular polygon sides = 3,
			draw,
			thick,
			inner sep = 0pt,
			minimum width = 7mm,
			minimum height = 7mm
		},
		path/.style = {
			->,
			thick,
			>=stealth'
		},
		cov/.style = {
			<->,
			thick,
			>=stealth'
		},
	]
	\node[manifest] (X1) {$X_{1}$};
	\node[inv] (vdots1) [below = of X1] {$\vdots$};
	\node[manifest] (Xj) [below = of vdots1] {$X_{j}$};
	\node[inv] (vdots2) [below = of Xj] {$\vdots$};
	\node[manifest] (Xp) [below = of vdots2] {$X_{p}$};
	\node[manifest] (Y) [left = of Xj] {$Y$};
	\node[error] (varepsilon) [below = of Y] {$\varepsilon$};
	\draw[path] (X1) to node[above] {$\beta_{1}$} (Y);
	\draw[path] (Xj) to node {$\beta_{j}$} (Y);
	\draw[path] (Xp) to node {$\beta_{p}$} (Y);
	\draw[path] (varepsilon) to node {$1$} (Y);
	\draw[cov] (X1) to[out = 70, in = 110, looseness = 5] node[above] {$\sigma_{X_{1}}^{2}$} (X1);
	\draw[cov] (Xj) to[out = 70, in = 110, looseness = 5] node[above] {$\sigma_{X_{j}}^{2}$} (Xj);
	\draw[cov] (Xp) to[out = 70, in = 110, looseness = 5] node[above] {$\sigma_{X_{p}}^{2}$} (Xp);
	\draw[cov] (varepsilon) to[out = 290, in = 250, looseness = 5] node[below] {$\sigma^{2}$} (varepsilon);
	\draw[cov] (X1) to[out = 360, in = 360, looseness = 0.5] node[right] {$\sigma_{X_{1}, X_{j}}$} (Xj);
	\draw[cov] (Xj) to[out = 360, in = 360, looseness = 0.5] node[right] {$\sigma_{X_{j}, X_{p}}$} (Xp);
	\draw[cov] (X1) to[out = 360, in = 360, looseness = 1] node[right] {$\sigma_{X_{1}, X_{p}}$} (Xp);
\end{tikzpicture}
```

```{r}
#| message = FALSE
library(semmcci)
library(lavaan)
```

## Data

```{r}
n <- 1000
X1 <- rnorm(n = n)
X2 <- 0.50 * X1 + rnorm(n = n)
Y <- 0.25 * X1 + 0.50 * X2 + rnorm(n = n)
data <- data.frame(X1, X2, Y)
```

## Model Specification

We regress `X1` and `X2` on `Y`.

```{r}
model <- "
  Y ~ X1 + X2
"
```

## Model Fitting

We can now fit the model using the `sem()` function from `lavaan`.

```{r}
fit <- sem(data = data, model = model, fixed.x = FALSE)
```

## Monte Carlo Confidence Intervals

The `fit` `lavaan` object can then be passed to the `MC()` function
to generate Monte Carlo confidence intervals.

```{r}
MC(fit, R = 20000L, alpha = c(0.001, 0.01, 0.05))
```

## Standardized Monte Carlo Confidence Intervals

Monte Carlo Confidence intervals for the standardized regression coefficients can be generated by passing the result of the `MC()` function to `MCStd()`.

> **Note:** We recommend setting `fixed.x = FALSE` when generating standardized estimates and confidence intervals to model the variances and covariances of the predictors if they are assumed to be random.

```{r}
fit <- sem(data = data, model = model, fixed.x = FALSE)
unstd <- MC(fit, R = 20000L, alpha = c(0.001, 0.01, 0.05))
MCStd(unstd)
```
