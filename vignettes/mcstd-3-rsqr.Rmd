---
title: "MCStd Function Use Case 3: R-Squared and Adjusted R-Squared"
author: "Ivan Jacob Agaloos Pesigan"
date: "2024-06-13"
bibliography: "vignettes.bib"
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
nocite: |
  @Pesigan-Cheung-2023
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{MCStd Function Use Case 3: R-Squared and Adjusted R-Squared}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- vignettes/mcstd-3-rsqr.Rmd is generated from .setup/vignettes/mcstd-3-rsqr.Rmd.orig. Please edit that file -->





The `MCStd()` function is used
to generate Monte Carlo confidence intervals
for $R^{2}$ and adjusted $R^{2}$ $\left( \bar{R}^{2}\right)$.


``` r
library(semmcci)
library(lavaan)
```

## Data

In this example,
we use data from @Kwan-Chan-2011
where child's reading ability ($Y_{1}$)
is regressed on home educational resources
and home educational resources ($Y_{2}$)
is regressed on
parental occupational status ($X_{1}$),
parental educational level ($X_{2}$), and
child's home possession ($X_{3}$)

$$
    Y_{1}
    =
    \alpha_{1}
    +
    \beta_{1}
    Y_{2}
    +
    \zeta_{1} ,
$$

$$
    Y_{2}
    =
    \alpha_{2}
    +
    \gamma_{1}
    X_{1}
    +
    \gamma_{2}
    X_{2}
    +
    \gamma_{3}
    X_{3}
    +
    \zeta_{2} .
$$

\noindent Note that $\zeta_{1}$ and $\zeta_{2}$ are stochastic error terms
with expected value of zero
and finite variance $\psi_{1}$ and $\psi_{2}$,
$\alpha_{1}$ and $\alpha_{2}$ are intercepts,
and $\beta_{1}$, $\gamma_{1}$, $\gamma_{2}$, and $\gamma_{3}$
are regression coefficients.

![Mediation Model (Covariance Structure)](https://raw.githubusercontent.com/jeksterslab/semmcci/main/.setup/latex/figures/png/kwan-2011-example-2.png)




``` r
covs
#>           Y1      Y2       X1      X2      X3
#> Y1 6088.8281 15.7012 271.1429 49.5848 20.0337
#> Y2   15.7012  0.7084   1.9878  1.0043  0.2993
#> X1  271.1429  1.9878 226.2577 29.9232  4.8812
#> X2   49.5848  1.0043  29.9232  9.0692  1.0312
#> X3   20.0337  0.2993   4.8812  1.0312  0.8371
```

``` r
nobs
#> [1] 200
```

## Model Specification

We regress `Y1` on `Y2` and `Y2` on `X1`, `X2`, and `X3`.
We label the error variances as `psi1` and `psi2`.
$R^{2}$ and $\bar{R}^{2}$
are defined using the `:=` operator
in the `lavaan` model syntax
using the following equations

$$
    R^{2}
    =
    1 - \psi^{\ast}
$$

$$
    \bar{R}^{2}
    =
    1
    -
    \left(
    \frac{n - 1}{n - p + 1}
    \right)
    \left(
    1 - R^2
    \right)
$$

\noindent where $\psi^{\ast}$
is the standardized error variance,
$n$ is the sample size,
and $p$ is the number of regressor variables.


``` r
model <- "
  Y1 ~ Y2
  Y2 ~ X1 + X2 + X3
  Y1 ~~ psi1 * Y1
  Y2 ~~ psi2 * Y2
  rsq1 := 1 - psi1
  rsqbar1 := 1 - (
    (200 - 1) / (200 - 1 + 1)
  ) * (
    1 - rsq1
  )
  rsq2 := 1 - psi2
  rsqbar2 := 1 - (
    (200 - 1) / (200 - 3 + 1)
  ) * (
    1 - rsq2
  )
"
```

## Model Fitting

We can now fit the model using the `sem()` function from `lavaan`
with `mimic = "eqs"`
to ensure compatibility with results from @Kwan-Chan-2011.

> **Note:** We recommend setting `fixed.x = FALSE`
> when generating standardized estimates and confidence intervals
> to model the variances and covariances of the exogenous observed variables
> if they are assumed to be random.
> If `fixed.x = TRUE`, which is the default setting in `lavaan`,
> `MC()` will fix the variances and the covariances
> of the exogenous observed variables to the sample values.


``` r
fit <- sem(
  model = model, mimic = "eqs", fixed.x = FALSE,
  sample.cov = covs, sample.nobs = nobs
)
#> Error: lavaan->ldw_parse_step2():  
#>    formula without valid operator at line 7, pos 5
#>     (200 - 1) / (200 - 1 + 1)
#>     ^
```

## Standardized Monte Carlo Confidence Intervals

Standardized Monte Carlo Confidence intervals can be generated by passing the result of the `MC()` function to the `MCStd()` function.

> **Note:** The parameterization of $R^{2}$ and $\bar{R}^{2}$ above
> should only be interpreted using the output of the `MCStd()` function
> since the input in the functions defined by `:=`
> require standardized estimates.


``` r
unstd <- MC(fit, R = 20000L, alpha = 0.05)
#> Error in eval(expr, envir, enclos): object 'fit' not found
```

``` r
MCStd(unstd, alpha = 0.05)
#> Error in eval(expr, envir, enclos): object 'unstd' not found
```

## References
