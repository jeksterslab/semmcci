---
title: "Example 5: Composite Reliability"
author: "Ivan Jacob Agaloos Pesigan"
date: "2023-07-21"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Example 5: Composite Reliability}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- vignettes/example-5-composite-reliability.Rmd is generated from .setup/vignettes/example-5-composite-reliability.Rmd.orig. Please edit that file -->



To cite `semmcci` in publications, please use: 

Pesigan, I. J. A., & Cheung, S. F. (2023).
Monte Carlo confidence intervals for the indirect effect with missing data.
*Behavior Research Methods*.
https://doi.org/10.3758/s13428-023-02114-4




```r
library(semmcci)
library(lavaan)
```

In this example,
the Monte Carlo method is used to generate confidence intervals
for composite reliability
using the Holzinger and Swineford (1939) data set.


```r
data(HolzingerSwineford1939, package = "lavaan")
```

\noindent The confirmatory factor analysis model for $X_{1}, \dots, X_{9}$
is given by

![Three-Factor Confirmatory Factor Analysis Model](https://raw.githubusercontent.com/jeksterslab/semmcci/main/latexsrc/figures/png/cfa.png)

\noindent $\eta_{1}$, $\eta_{2}$, and $\eta_{3}$ are the latent factors.
$\eta_{1}$ has three indicators $X_{1}$, $X_{2}$, and $X_{3}$;
$\eta_{2}$ has three indicators $X_{4}$, $X_{5}$, and $X_{6}$; and
$\eta_{3}$ has three indicators $X_{7}$, $X_{8}$, and $X_{9}$ .
The variances of $\eta_{1}$, $\eta_{2}$, and $\eta_{3}$ are constrained to one.

## Model Specification

Assuming that the latent variable variance is constrained to one,
the omega total reliability coefficient is given by

\begin{equation}
  \omega_{\mathrm{total}}
  =
  \frac{
  \left(
  \sum_{i = 1}^{k}
  \lambda_{i}
  \right)^2
  }{
  \left(
  \sum_{i = 1}^{k}
  \lambda_{i}
  \right)^2
  +
  \sum_{i = 1}^{k}
  \theta_{\varepsilon_{ii}}
  }
\end{equation}

\noindent where $\lambda_{i}$ is the factor loading for item $i$,
$\theta_{\varepsilon_{ii}}$ is the residual variance for item $i$,
and $k$ is the number of items for a particular latent variable.

In the model specification below,
the variances of the latent variables `eta1`, `eta2`, and `eta3` are constrained to one,
all the relevant parameters are labeled particularly the factor loadings and the error variances,
and the omega total reliability coefficient per latent variable are defined
using the `:=` operator.


```r
model <- "
  # fix latent variable variances to 1
  eta1 ~~ 1 * eta1
  eta2 ~~ 1 * eta2
  eta3 ~~ 1 * eta3
  # factor loadings
  eta1 =~ NA * x1 + l11 * x1 + l12 * x2 + l13 * x3
  eta2 =~ NA * x4 + l24 * x4 + l25 * x5 + l26 * x6
  eta3 =~ NA * x7 + l37 * x7 + l38 * x8 + l39 * x9
  # error variances
  x1 ~~ t1 * x1
  x2 ~~ t2 * x2
  x3 ~~ t3 * x3
  x4 ~~ t4 * x4
  x5 ~~ t5 * x5
  x6 ~~ t6 * x6
  x7 ~~ t7 * x7
  x8 ~~ t8 * x8
  x9 ~~ t9 * x9
  # composite reliability
  omega1 := (l11 + l12 + l13)^2 / ((l11 + l12 + l13)^2 + (t1 + t2 + t3))
  omega2 := (l24 + l25 + l26)^2 / ((l24 + l25 + l26)^2 + (t4 + t5 + t6))
  omega3 := (l37 + l38 + l39)^2 / ((l37 + l38 + l39)^2 + (t7 + t8 + t9))
"
```

## Model Fitting

We can now fit the model using the `cfa()` function from `lavaan`.


```r
fit <- cfa(model = model, data = HolzingerSwineford1939)
```

### Monte Carlo Confidence Intervals

The `fit` `lavaan` object can then be passed to the `MC()` function
to generate Monte Carlo confidence intervals.


```r
MC(fit, R = 20000L, alpha = 0.05)
#> Monte Carlo Confidence Intervals
#>               est     se     R   2.5%  97.5%
#> eta1~~eta1 1.0000 0.0000 20000 1.0000 1.0000
#> eta2~~eta2 1.0000 0.0000 20000 1.0000 1.0000
#> eta3~~eta3 1.0000 0.0000 20000 1.0000 1.0000
#> l11        0.8996 0.0805 20000 0.7395 1.0571
#> l12        0.4979 0.0774 20000 0.3433 0.6489
#> l13        0.6562 0.0748 20000 0.5090 0.7999
#> l24        0.9897 0.0565 20000 0.8776 1.1015
#> l25        1.1016 0.0632 20000 0.9770 1.2256
#> l26        0.9166 0.0537 20000 0.8128 1.0227
#> l37        0.6195 0.0699 20000 0.4842 0.7564
#> l38        0.7309 0.0662 20000 0.6008 0.8590
#> l39        0.6700 0.0653 20000 0.5411 0.7971
#> t1         0.5491 0.1136 20000 0.3273 0.7746
#> t2         1.1338 0.1012 20000 0.9356 1.3336
#> t3         0.8443 0.0910 20000 0.6623 1.0218
#> t4         0.3712 0.0477 20000 0.2771 0.4643
#> t5         0.4463 0.0585 20000 0.3321 0.5618
#> t6         0.3562 0.0431 20000 0.2722 0.4402
#> t7         0.7994 0.0815 20000 0.6382 0.9577
#> t8         0.4877 0.0744 20000 0.3422 0.6335
#> t9         0.5661 0.0716 20000 0.4276 0.7066
#> eta1~~eta2 0.4585 0.0638 20000 0.3338 0.5845
#> eta1~~eta3 0.4705 0.0733 20000 0.3255 0.6129
#> eta2~~eta3 0.2830 0.0691 20000 0.1462 0.4188
#> omega1     0.6253 0.0368 20000 0.5467 0.6915
#> omega2     0.8852 0.0116 20000 0.8604 0.9058
#> omega3     0.6878 0.0310 20000 0.6208 0.7435
```
