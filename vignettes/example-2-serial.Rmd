---
title: "Example 2: The Serial Mediation Model"
author: "Ivan Jacob Agaloos Pesigan"
date: "2023-07-21"
bibliography: "vignettes.bib"
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
nocite: |
  @Pesigan-Cheung-2023
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Example 2: The Serial Mediation Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- vignettes/example-2-serial.Rmd is generated from .setup/vignettes/example-2-serial.Rmd.orig. Please edit that file -->





In this example,
the Monte Carlo method is used to generate confidence intervals
for the indirect effects in a serial mediation model with two mediators
where `X` is the predictor, `M1` is the first mediator, `M2` is the second mediator,
and `Y` is the dependent variable.

![The Serial Mediation Model](https://raw.githubusercontent.com/jeksterslab/semmcci/main/latexsrc/figures/png/serial.png)


```r
library(semmcci)
library(lavaan)
```

## Data




```r
summary(df)
#>        X                  M1                 M2                 Y           
#>  Min.   :-3.37174   Min.   :-3.22690   Min.   :-4.33590   Min.   :-4.29019  
#>  1st Qu.:-0.67546   1st Qu.:-0.73709   1st Qu.:-0.82188   1st Qu.:-0.86035  
#>  Median :-0.01313   Median :-0.01651   Median :-0.03903   Median :-0.02704  
#>  Mean   :-0.02582   Mean   :-0.01823   Mean   :-0.01620   Mean   :-0.03338  
#>  3rd Qu.: 0.66400   3rd Qu.: 0.72825   3rd Qu.: 0.80016   3rd Qu.: 0.81721  
#>  Max.   : 3.49530   Max.   : 3.69001   Max.   : 3.65147   Max.   : 4.05239
colMeans(df)
#>           X          M1          M2           Y 
#> -0.02582443 -0.01823021 -0.01619576 -0.03337865
var(df)
#>            X        M1        M2         Y
#> X  1.0050488 0.5123920 0.3848638 0.3333458
#> M1 0.5123920 1.2334461 0.6645408 0.5108946
#> M2 0.3848638 0.6645408 1.4321822 0.8012638
#> Y  0.3333458 0.5108946 0.8012638 1.4504417
```

## Model Specification

We can define several indirect effects in this example:

  - $X \rightarrow M1 \rightarrow M2 \rightarrow Y$
  - $X \rightarrow M1 \rightarrow M2$
  - $X \rightarrow M1 \rightarrow Y$
  - $M1 \rightarrow M2 \rightarrow Y$

These indirect effects are defined using the `:=` operator
in the `lavaan` model syntax.


```r
model <- "
  Y ~ cp * X + b1 * M1 + b2 * M2
  M2 ~ a2 * X + k * M1
  M1 ~ a1 * X
  # X -> M1 -> M2 -> Y
  a1kb2 := a1 * k * b2
  # X -> M1 -> M2
  a1k := a1 * k
  # X -> M1 -> Y
  a2b2 := a2 * b2
  # M1 -> M2 -> Y
  kb2 := k * b2
"
```

## Model Fitting


```r
fit <- sem(data = df, model = model)
```

## Monte Carlo Confidence Intervals

The `fit` `lavaan` object can then be passed to the `MC()` function from `semmcci`
to generate Monte Carlo confidence intervals.


```r
MC(fit, R = 20000L, alpha = 0.05)
#> Monte Carlo Confidence Intervals
#>           est     se     R   2.5%  97.5%
#> cp     0.0868 0.0352 20000 0.0172 0.1556
#> b1     0.1190 0.0351 20000 0.0507 0.1883
#> b2     0.4809 0.0302 20000 0.4221 0.5400
#> a2     0.1373 0.0368 20000 0.0651 0.2102
#> k      0.4817 0.0331 20000 0.4169 0.5463
#> a1     0.5098 0.0310 20000 0.4486 0.5703
#> Y~~Y   0.9744 0.0437 20000 0.8879 1.0600
#> M2~~M2 1.0581 0.0471 20000 0.9653 1.1507
#> M1~~M1 0.9712 0.0433 20000 0.8859 1.0555
#> X~~X   1.0040 0.0000 20000 1.0040 1.0040
#> a1kb2  0.1181 0.0132 20000 0.0937 0.1451
#> a1k    0.2456 0.0225 20000 0.2029 0.2910
#> a2b2   0.0660 0.0182 20000 0.0311 0.1025
#> kb2    0.2317 0.0216 20000 0.1905 0.2753
```

## Standardized Monte Carlo Confidence Intervals

Standardized Monte Carlo Confidence intervals can be generated by passing the result of the `MC()` function to the `MCStd()` function.

> **Note:** We recommend setting `fixed.x = FALSE`
> when generating standardized estimates and confidence intervals
> to model the variances and covariances of the exogenous observed variables
> if they are assumed to be random.
> If `fixed.x = TRUE`, which is the default setting in `lavaan`,
> `MC()` will fix the variances and the covariances
> of the exogenous observed variables to the sample values.


```r
fit <- sem(data = df, model = model, fixed.x = FALSE)
unstd <- MC(fit, R = 20000L, alpha = 0.05)
```


```r
MCStd(unstd, alpha = 0.05)
#> Standardized Monte Carlo Confidence Intervals
#>           est     se     R   2.5%  97.5%
#> cp     0.0723 0.0292 20000 0.0148 0.1296
#> b1     0.1098 0.0321 20000 0.0469 0.1723
#> b2     0.4779 0.0278 20000 0.4232 0.5315
#> a2     0.1151 0.0306 20000 0.0546 0.1743
#> k      0.4470 0.0283 20000 0.3905 0.5017
#> a1     0.4602 0.0250 20000 0.4105 0.5085
#> Y~~Y   0.6725 0.0244 20000 0.6228 0.7180
#> M2~~M2 0.7396 0.0238 20000 0.6912 0.7853
#> M1~~M1 0.7882 0.0230 20000 0.7415 0.8315
#> X~~X   1.0000 0.0000 20000 1.0000 1.0000
#> a1kb2  0.0983 0.0105 20000 0.0790 0.1199
#> a1k    0.2057 0.0177 20000 0.1722 0.2413
#> a2b2   0.0550 0.0150 20000 0.0259 0.0847
#> kb2    0.2136 0.0189 20000 0.1773 0.2517
```

## References
